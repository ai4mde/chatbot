# ChatBack Service

This directory contains the backend service (`chatback`) for the chatbot application. It is built using FastAPI and handles the core business logic, data persistence, and interactions with AI models.

## Features

*   **FastAPI Framework:** Provides a modern, asynchronous RESTful API.
*   **Database Integration:** Uses PostgreSQL as the primary database.
*   **ORM & Migrations:** Leverages SQLAlchemy for object-relational mapping and Alembic for database schema migrations.
*   **Vector Store:** Integrates with Qdrant for efficient vector similarity searches (likely for Retrieval-Augmented Generation - RAG).
*   **LLM Integration:** Uses Langchain and the OpenAI API for interacting with large language models, generating embeddings, and potentially managing conversational agents/graphs (indicated by `langgraph`).
*   **Data Validation:** Employs Pydantic schemas for robust request/response validation and data structuring.
*   **Configuration Management:** Loads settings from environment variables (see `config/chatback.env` - **Note:** This file should not be committed. Use a `.env.example` for templates).
*   **Background Tasks/Caching:** Likely utilizes Redis for caching or managing asynchronous tasks/message history.
*   **Authentication:** Includes dependencies for JWT-based authentication (`python-jose`, `passlib`).
*   **Containerization:** Provides a `Dockerfile` for building container images (compatible with Docker and Podman).
*   **Dependency Management:** Uses `pyproject.toml` for managing Python dependencies.
*   **Nix Environment:** Includes `shell.nix` for setting up a development environment using Nix.

## Key Components

*   `app/`: Contains the core application logic, including:
    *   `main.py`: FastAPI application setup and entry point.
    *   `api/` / `routers/`: API endpoint definitions.
    *   `services/`: Business logic layer (e.g., vector store interactions, LLM calls).
    *   `crud/`: Database interaction logic (Create, Read, Update, Delete).
    *   `models/`: SQLAlchemy database models.
    *   `schemas/`: Pydantic data schemas.
    *   `db/` / `database.py`: Database session management.
    *   `core/`: Application configuration and core settings.
*   `alembic/`: Database migration scripts managed by Alembic.
*   `config/`: Contains configuration files (like `.env` templates).
*   `tests/`: Automated tests (using Pytest).

## Running the Service

*(Instructions for running locally, e.g., using uvicorn, or via Docker/Podman using the main compose file, should be added here or referenced from the root README)*

## TODO

*   [ ] Add comprehensive unit and integration tests for all API endpoints and services.
*   [ ] Enhance error handling and logging across the application.
*   [ ] Document the API endpoints (e.g., using OpenAPI documentation generated by FastAPI).
*   [ ] Implement detailed user authentication and authorization flows.
*   [ ] Optimize database queries and vector search performance.
*   [ ] Add monitoring and health check endpoints.
*   [ ] Refactor complex service logic for better maintainability.
*   [ ] Create a `.env.example` file based on `config/chatback.env`.
*   [ ] Improve inline code documentation/comments.

## Development Setup

1. Enter the Nix shell:
   ```bash
   cd chatback
   nix-shell
   ```

2. Start the API server:
   ```bash
   ./bin/dev api
   ```

3. Run tests:
   ```bash
   ./bin/dev test
   ```

4. Run database migrations:
   ```bash
   ./bin/dev migrate
   ```

## Environment

The application requires the following services:
- PostgreSQL: Running on port 5432
- Redis: Running on port 6379
- Qdrant: Running on port 6333

## Configuration

Configuration is managed through environment variables defined in `config/chatback.env`. 